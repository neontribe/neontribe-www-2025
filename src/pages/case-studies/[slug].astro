---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import Tag from '../../components/ui/Tag.astro';

export async function getStaticPaths() {
  const caseStudies = await getCollection('case-studies');
  return caseStudies.map((entry) => {
    const slug = entry.id.replace(/\.md$/, '');
    return {
      params: { slug },
      props: { entry },
    };
  });
}

interface Props {
  entry: CollectionEntry<'case-studies'>;
}

const { entry } = Astro.props;
const slug = Astro.params.slug;

const { Content } = await entry.render();
const {
  title,
  description,
  customer,
  categories = [],
  statistic,
  heroImage,
  heroImageAlt,
  tags = [],
} = entry.data;
---

<Layout title={title} description={description}>
  <Header />
  <!-- Hero Section with Dark Background -->
  <section class="section section-dark pt-12 pb-16 md:pt-16 md:pb-20 lg:pb-32 relative overflow-hidden" aria-label="Case study hero">
    <div class="container">
      <div class="mx-auto" style="max-width: 1200px;">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-8 items-start relative">
          <!-- Left Column: Title, Customer, Categories -->
          <div class="md:col-span-7 lg:col-span-6">
            <h1 class="text-text-light mb-4 md:mb-6 leading-tight" style="font-family: 'Keep Calm', sans-serif; font-weight: 400; font-size: 36px;">
              {title}
            </h1>
            
            {customer && (
              <p class="text-[var(--color-accent-turquoise)] mb-4 md:mb-6" style="font-family: 'Keep Calm', sans-serif; font-weight: 400; font-size: 22px;">
                {customer}
              </p>
            )}
            
            {categories.length > 0 && (
              <p class="text-text-light opacity-80" style="font-family: 'Mulish', sans-serif; font-weight: 400; font-size: 22px;">
                Categories: {categories.join(', ')}
              </p>
            )}
          </div>
          
          <!-- Right Column: Hero Image (overlapping) -->
          {heroImage && (
            <div class="md:col-span-5 lg:col-span-6 relative z-10 mt-6 md:mt-0 flex justify-center md:justify-end">
              <img 
                src={heroImage.src} 
                alt={heroImageAlt || `${title} - case study hero image`}
                width={heroImage.width || 300}
                height={heroImage.height || 600}
                class="max-w-full h-auto md:max-w-sm lg:max-w-md"
                loading="eager"
              />
            </div>
          )}
        </div>
      </div>
    </div>
  </section>

  <!-- White Introduction Section with Description -->
  <section class="section section-light -mt-12 md:-mt-20 lg:-mt-24 relative z-20 py-8 md:py-12">
    <div class="container">
      <div class="mx-auto" style="max-width: 1200px;">
        {description && (
          <p class="text-text-dark leading-relaxed" style="font-family: 'Mulish', sans-serif; font-weight: 700; font-size: 24px;">
            {description}
          </p>
        )}
      </div>
    </div>
  </section>

  <!-- Main Content Section with Light Grey Background -->
  <main id="content" class="section section-intro py-12 md:py-16">
    <div class="container">
      <div class="mx-auto" style="max-width: 1200px;">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-8">
          <!-- Left Column: Main Text Content -->
          <div class="md:col-span-7 lg:col-span-8 order-1">
            <div class="case-study-content markdown-content">
              <Content />
            </div>
          </div>
          
          <!-- Right Column: Placeholder Containers -->
          <div class="md:col-span-5 lg:col-span-4 order-2">
            <div class="flex flex-col gap-6">
              <!-- Purple Container Placeholder -->
              <div class="quote-placeholder bg-[var(--color-accent-amethyst)] rounded-lg p-6 md:p-8 min-h-[200px]">
                <!-- Placeholder for future quote/testimonial content -->
              </div>
              
              <!-- Black Container Placeholder -->
              <div class="statistics-placeholder bg-[var(--color-bg-dark)] rounded-lg p-6 min-h-[100px]">
                <!-- Placeholder for future statistics content -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <Footer />
</Layout>
