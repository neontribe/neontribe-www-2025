---
import Layout from '../layouts/Layout.astro';
import HeaderHeroContainer from '../components/sections/HeaderHeroContainer.astro';
import GetInTouch from '../components/sections/GetInTouch.astro';
import Footer from '../components/layout/Footer.astro';
import CaseStudyCard from '../components/Card/CaseStudyCard.astro';
import { getCollection } from 'astro:content';
import { sortCaseStudiesByDateDesc } from '../utils/dateSorting';
import cardImage from '../assets/CardImage.svg';
import arcCardImage from '../content/case-studies/images/arc-card.png';
import infosecCardImage from '../content/case-studies/images/infosec-card.png';
import momoCardImage from '../content/case-studies/images/momo-card.png';
import npcCardImage from '../content/case-studies/images/npc-card.png';
import parentingSmartCardImage from '../content/case-studies/images/parenting-smart-card.png';
import realChatAiCardImage from '../content/case-studies/images/real-chat-ai-card.png';

const caseStudies = await getCollection('case-studies');

// Sort case studies by date descending (newest first)
const sortedCaseStudies = sortCaseStudiesByDateDesc(caseStudies);

// Array with case studies + 2 placeholder cards
const allCards = [...sortedCaseStudies];
while (allCards.length < sortedCaseStudies.length + 2) {
  allCards.push(null);
}
---

<Layout title="Case studies">
  <HeaderHeroContainer 
    title="Case studies" 
    subtitle="A brief description of the case studies here and the types of organisations that we work with. Should be no more than two sentences."
    icon="case-studies" 
  />
  <main id="content">
    <section class="section section-intro py-10 lg:py-12">
      <div class="w-full md:max-w-[1336px] md:mx-auto px-8 md:px-10">
        <div class="case-studies-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-10 items-stretch">
          {allCards.map((entry, index) => {
            if (entry) {
              const slug = entry.id.replace(/\.md$/, '');
              const customer = slug === 'infosecurity' ? 'Infosec at Neontribe' : (entry.data.customer || '');
              // Map slugs to optimized card images
              const cardImageMap = {
                'arc': arcCardImage,
                'infosecurity': infosecCardImage,
                'momo': momoCardImage,
                'npc': npcCardImage,
                'place2be': parentingSmartCardImage,
                'ncs-realchat-ai': realChatAiCardImage,
              };
              const imageSrc = cardImageMap[slug] || cardImage;
              return (
                <CaseStudyCard
                  customer={customer}
                  title={entry.data.title}
                  summary={entry.data.description}
                  imageSrc={imageSrc}
                  altText={entry.data.heroImageAlt || entry.data.title}
                  linkHref={`/case-studies/${slug}`}
                />
              );
            } else {
              // Placeholder card
              return (
                <CaseStudyCard
                  customer="Client Name"
                  title="Case Study Title"
                  summary="A brief description of the project problem and the process we took to solve it."
                  imageSrc={cardImage}
                  altText="Case study placeholder"
                  linkHref="/case-studies/arc"
                />
              );
            }
          })}
        </div>
      </div>
    </section>
  </main>
  <div class="bg-bg-dark w-full">
    <GetInTouch />
    <Footer />
  </div>
</Layout>

<style>
  /* Align card images by ensuring text sections have consistent height - replaces JavaScript */
  @media (min-width: 768px) {
    /* Grid already stretches items, ensure cards fill height */
    .case-studies-grid .case-study-card {
      height: 100%;
    }
    
    /* Make text sections use flexbox for consistent alignment */
    /* Since cards are same height from grid, text sections will align naturally */
    .case-study-content__text-section {
      display: flex;
      flex-direction: column;
      /* Cards in same row will have same height, so text sections align */
    }
  }
</style>


