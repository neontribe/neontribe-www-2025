---
import Button from '../Button/Button.astro';
import fullLogo from '../../assets/Full-logo.svg';
import neontribeLogo from '../../assets/neontribe-logo.svg';
const currentPath = Astro.url.pathname;
---

<header id="site-header" class="section section-dark w-full">
  <a href="#content" class="skip-link">Skip to main content</a>

  <div class="w-full flex justify-center">
    <div class="w-full md:max-w-[1420px] md:mx-auto flex items-center justify-between py-0 header-container overflow-hidden">
      <div class="px-4 sm:px-1.5 md:px-3 lg:px-4 xl:px-10 flex items-center justify-between w-full min-w-0 overflow-hidden">
    <!-- Logo -->
    <div class="flex-shrink-0">
      <a href="/" aria-label="Go to homepage" class="block">
        <img src={fullLogo.src} alt="Neontribe" class="block sm:hidden h-6 w-auto" />
        <img src={neontribeLogo.src} alt="Neontribe" class="hidden sm:block xl:hidden h-3 sm:h-3 md:h-3 lg:h-3.5 w-auto" />
        <img src={fullLogo.src} alt="Neontribe" class="hidden xl:block h-8 w-auto" />
      </a>
    </div>

    <!-- Desktop Navigation -->
    <nav class="hidden sm:flex sm:flex-row sm:flex-nowrap items-center gap-1 max-md:gap-0.5 md:gap-1 lg:gap-2 xl:gap-6 flex-shrink sm:ml-1 max-md:ml-0.5 md:ml-1 lg:ml-2 xl:ml-6 min-w-0 overflow-hidden" aria-label="Main navigation">
      <a
        href="/case-studies"
        class={`nav-link ${currentPath === '/case-studies' ? 'active' : ''}`}
        aria-current={currentPath === '/case-studies' ? 'page' : undefined}
      >Case Studies</a>

      <a
        href="/how-we-work"
        class={`nav-link ${currentPath === '/how-we-work' ? 'active' : ''}`}
        aria-current={currentPath === '/how-we-work' ? 'page' : undefined}
      >How We Work</a>

      <a
        href="/advice-service"
        class={`nav-link ${currentPath === '/advice-service' ? 'active' : ''}`}
        aria-current={currentPath === '/advice-service' ? 'page' : undefined}
      >Advice Service</a>
    </nav>

    <!-- Button wrapper - hidden on mobile portrait, visible on landscape mobile and desktop -->
    <div class="hidden sm:flex flex-shrink-0 ml-0.5 sm:ml-1 md:ml-0 header-button-wrapper">
      <Button href="/talk-to-us" variant="teal" size="sm" class="whitespace-nowrap">Talk to us</Button>
    </div>

    <!-- Mobile Menu Button - visible only on mobile portrait -->
    <button
      class="mobile-toggle sm:hidden flex flex-col justify-center items-center gap-[3px] w-8 h-8 bg-transparent border-0 cursor-pointer p-1 rounded"
      aria-expanded="false"
      aria-controls="mobile-menu"
      aria-label="Toggle navigation menu"
    >
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <nav id="mobile-menu" class="mobile-menu hidden" aria-label="Mobile navigation" aria-hidden="true">
    <div class="mobile-content">
      <a href="/case-studies"  class={`mobile-link ${currentPath === '/case-studies'  ? 'active' : ''}`} aria-current={currentPath === '/case-studies' ? 'page' : undefined}>Case Studies</a>
      <a href="/how-we-work"   class={`mobile-link ${currentPath === '/how-we-work'   ? 'active' : ''}`} aria-current={currentPath === '/how-we-work' ? 'page' : undefined}>How We Work</a>
      <a href="/advice-service" class={`mobile-link ${currentPath === '/advice-service' ? 'active' : ''}`} aria-current={currentPath === '/advice-service' ? 'page' : undefined}>Advice Service</a>
      <div class="mobile-cta">
        <Button href="/talk-to-us" variant="teal" size="sm">Talk to us</Button>
      </div>
    </div>
  </nav>
</header>

<!-- Global rules that must escape component scoping -->
<style is:global>
  body.menu-open { overflow: hidden; position: fixed; width: 100%; }
  body.menu-open .mobile-toggle {
    position: fixed;
    top: 12px;
    right: 16px;
    z-index: 1101;
    background: transparent;
  }
</style>

<style>
  .skip-link{
    position:absolute; top:-40px; left:6px;
    background:var(--color-accent-amethyst); color:var(--color-text-light);
    padding:8px; border-radius:4px; z-index:1000; transition:top .3s;
  }
  .skip-link:focus{ top:6px; }

  .mobile-toggle{ z-index:1101; }
  .mobile-toggle:focus{ outline:2px solid var(--color-accent-turquoise); outline-offset:2px; }
  .mobile-toggle:hover{ background:rgba(255,255,255,.1); }
  .hamburger-line{ width:18px; height:2px; background:var(--color-text-light); transition:transform .3s, opacity .3s, background .2s ease; }
  .mobile-toggle:hover .hamburger-line{ background:#48E9CE; }
  .mobile-toggle[aria-expanded="true"] .hamburger-line:nth-child(1){ transform:rotate(45deg) translate(4px,4px); }
  .mobile-toggle[aria-expanded="true"] .hamburger-line:nth-child(2){ opacity:0; }
  .mobile-toggle[aria-expanded="true"] .hamburger-line:nth-child(3){ transform:rotate(-45deg) translate(4px,-4px); }

  .mobile-menu{
    position:fixed; inset:0; background:rgba(0,0,0,.95); z-index:1000;
    display:none; opacity:0; visibility:hidden; pointer-events:none;
    align-items:center; justify-content:center;
    overflow-y:auto;
    transition:opacity .3s, visibility .3s;
  }
  .mobile-menu:not(.hidden){
    display:flex; opacity:1; visibility:visible; pointer-events:auto;
  }

  .mobile-content{
    display:flex; flex-direction:column; align-items:center; text-align:center;
    gap:1.5rem; padding:2rem; width:100%; max-width:400px;
    min-height:100vh; box-sizing:border-box; justify-content:center;
  }
  @supports (height: 100dvh){
    .mobile-content{ min-height:100dvh; }
  }

  .mobile-link{
    color:var(--color-text-light); 
    text-decoration:none; 
    font-size:1.5rem; 
    font-weight:500;
    padding:12px 24px; 
    min-height:44px; 
    display:flex; 
    align-items:center; 
    transition:color .2s ease, text-decoration .2s ease, text-decoration-color .2s ease, text-decoration-thickness .2s ease;
    white-space:nowrap;
  }
  .mobile-link.active{ 
    color:var(--color-accent-turquoise); 
    text-decoration:none;
  }
  .mobile-link:hover,
  .mobile-link.active:hover{ 
    color:#48E9CE !important; 
    text-decoration:underline !important;
    text-decoration-color:#48E9CE !important;
    text-decoration-thickness:2px !important;
    text-underline-offset:0.25rem !important;
  }
  .mobile-link:focus{ 
    outline:2px solid var(--color-accent-turquoise); 
    outline-offset:2px; 
    border-radius:2px; 
  }
  .mobile-link:active{ 
    outline:none; 
  }

  .mobile-cta{ margin-top:1rem; }

  @media (max-width:480px){
    .mobile-content{ padding:1.5rem 1rem; }
    .mobile-link{ font-size: var(--text-lg); padding:12px 20px; }
  }
</style>

<script is:inline>
  function initMobileMenu(){
    const root   = document.getElementById('site-header');
    const toggle = root?.querySelector('.mobile-toggle');
    const menu   = root?.querySelector('#mobile-menu');
    const links  = root?.querySelectorAll('.mobile-link') ?? [];
    const body   = document.body;
    if(!toggle || !menu) return;

    let isOpen = false;

    const closeMenu = ()=>{
      isOpen = false;
      toggle.setAttribute('aria-expanded','false');
      menu.setAttribute('aria-hidden','true');
      menu.classList.add('hidden');
      body.classList.remove('menu-open');
    };

    const openMenu = ()=>{
      isOpen = true;
      toggle.setAttribute('aria-expanded','true');
      menu.setAttribute('aria-hidden','false');
      menu.classList.remove('hidden');
      body.classList.add('menu-open');
    };

    toggle.addEventListener('click', ()=> (isOpen ? closeMenu() : openMenu()));

    
    Array.from(links).forEach((a) => {
      if (a instanceof HTMLAnchorElement) a.addEventListener('click', closeMenu);
    });

    document.addEventListener('keydown', (e) => { if(e.key==='Escape' && isOpen) closeMenu(); });
    menu.addEventListener('click', (e) => { if(e.target === menu) closeMenu(); });
    window.addEventListener('resize', () => { if(window.innerWidth >= 640 && isOpen) closeMenu(); });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  } else {
    initMobileMenu();
  }
</script>


