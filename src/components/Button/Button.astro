---
export interface Props {
  href?: string;
  variant?: "primary" | "secondary" | "teal" | "link";
  size?: "sm" | "md" | "lg" | "get-in-touch";
  external?: boolean;
  ariaLabel?: string;
  class?: string;
  type?: "button" | "submit" | "reset";
}

const {
  href,
  variant = "primary",
  size = "md",
  external = false,
  ariaLabel,
  class: className,
  type = "button",
} = Astro.props;


const VARIANT: Record<
  NonNullable<Props["variant"]>,
  { bg: string; color: string; hover: string; iconColor: string; textDecoration?: string }
> = {
  primary:   { bg: "#4B00E7", color: "#FFFFFF", hover: "filter: brightness(1.1);",  iconColor: "#48E9CE" },
  secondary: { bg: "#D1D5DB", color: "#111827", hover: "filter: brightness(0.95);", iconColor: "#4B00E7" },
  teal:      { bg: "#48E9CE", color: "#111827", hover: "filter: brightness(0.95);", iconColor: "#4B00E7" },
  link:      { bg: "transparent", color: "#4B00E7", hover: "opacity: 0.8;", iconColor: "#4B00E7", textDecoration: "none" },
};

const { bg, color, hover, iconColor, textDecoration } = VARIANT[variant];

const SIZE: Record<NonNullable<Props["size"]>, string> = {
  sm: "padding: 8px 16px; height: 40px;",
  md: "padding: 12px 24px; height: 48px;",
  lg: "padding: 16px 32px; height: 56px;",
  "get-in-touch": "padding: 12px 24px; height: 48px;",
};

const baseStyle = `
  display: inline-flex;
  align-items: center;
  gap: 10px;
  border-radius: 1px;
  font-family: var(--button-font-family);
  font-weight: var(--button-font-weight);
  font-size: var(--button-font-size);
  line-height: var(--button-line-height);
  text-decoration: ${textDecoration || 'none'};
  transition: filter 0.15s ease, transform 0.05s ease, opacity 0.15s ease;
  background-color: ${bg};
  color: ${color};
  white-space: nowrap;
  ${SIZE[size]}
`;

const focusStyle = variant === 'link' ? '' : `
  outline: 2px solid #4B00E7;
  outline-offset: 2px;
`;


function normalizeCSS(str: string): string {
  if (!str) return '';
  return str.replace(/\s+/g, ' ').trim();
}

const baseStyleEscaped = normalizeCSS(baseStyle);
const hoverEscaped = normalizeCSS(hover);
const focusStyleEscaped = normalizeCSS(focusStyle);
---

{href ? (
  <a
    href={href}
    target={external ? "_blank" : undefined}
    rel={external ? "noopener noreferrer" : undefined}
    aria-label={ariaLabel}
    class={className}
    style={baseStyle}
    onmouseover={`this.style.cssText="${baseStyleEscaped}${hoverEscaped}"`}
    onmouseout={`this.style.cssText="${baseStyleEscaped}"`}
    onfocus={`this.style.cssText="${baseStyleEscaped}${hoverEscaped}${focusStyleEscaped}"`}
    onblur={`this.style.cssText="${baseStyleEscaped}"`}
    onmousedown="this.style.transform='translateY(1px)'"
    onmouseup="this.style.transform='none'"
  >
    <span><slot /></span>
    <span class="button-arrow" style={`color: ${iconColor}; font-size: var(--text-xl); line-height: 1;`} aria-hidden="true">→</span>
  </a>
) : (
  <button
    type={type}
    aria-label={ariaLabel}
    class={className}
    style={`${baseStyle}; border: none; cursor: pointer;`}
    onmouseover={`this.style.cssText="${baseStyleEscaped}${hoverEscaped}; border: none; cursor: pointer;"`}
    onmouseout={`this.style.cssText="${baseStyleEscaped}; border: none; cursor: pointer;"`}
    onfocus={`this.style.cssText="${baseStyleEscaped}${hoverEscaped}${focusStyleEscaped}; border: none; cursor: pointer;"`}
    onblur={`this.style.cssText="${baseStyleEscaped}; border: none; cursor: pointer;"`}
    onmousedown="this.style.transform='translateY(1px)'"
    onmouseup="this.style.transform='none'"
  >
    <span><slot /></span>
    <span class="button-arrow" style={`color: ${iconColor}; font-size: var(--text-xl); line-height: 1;`} aria-hidden="true">→</span>
  </button>
)}

<style>
  .button-arrow {
    margin-left: auto;
  }
  
  @media (min-width: 768px) {
    .button-arrow {
      margin-left: 0;
    }
  }
</style>

